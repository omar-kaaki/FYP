# configtx.yaml - Hyperledger Fabric v2.5.14 Network Configuration
# FYP Blockchain - DFIR Chain of Custody System
# COLD BLOCKCHAIN - Archival Chain
#
# This file defines:
# - Organizations (OrdererOrg, LabOrg, CourtOrg)
# - Channel profile (cold-chain)
# - Orderer configuration (Raft consensus)
# - Application capabilities

---

################################################################################
#
#   ORGANIZATIONS
#
#   This section defines the organizational identities that can be referenced
#   in the configuration profiles.
#
################################################################################

Organizations:
  # OrdererOrg defines the ordering service organization
  - &OrdererOrg
      Name: OrdererOrg
      ID: OrdererOrgMSP
      MSPDir: /home/user/FYPBcoc/cold-blockchain/crypto-config/ordererOrganizations/ordererorg.cold.coc.com/msp

      Policies:
        Readers:
          Type: Signature
          Rule: "OR('OrdererOrgMSP.member')"
        Writers:
          Type: Signature
          Rule: "OR('OrdererOrgMSP.member')"
        Admins:
          Type: Signature
          Rule: "OR('OrdererOrgMSP.admin')"

      OrdererEndpoints:
        - orderer.cold.coc.com:7150

  # LabOrg defines the DFIR lab organization (primary evidence handler)
  - &LabOrg
      Name: LabOrg
      ID: LabOrgMSP
      MSPDir: /home/user/FYPBcoc/cold-blockchain/crypto-config/peerOrganizations/laborg.cold.coc.com/msp

      Policies:
        Readers:
          Type: Signature
          Rule: "OR('LabOrgMSP.admin', 'LabOrgMSP.peer', 'LabOrgMSP.client')"
        Writers:
          Type: Signature
          Rule: "OR('LabOrgMSP.admin', 'LabOrgMSP.peer', 'LabOrgMSP.client')"
        Admins:
          Type: Signature
          Rule: "OR('LabOrgMSP.admin')"
        Endorsement:
          Type: Signature
          Rule: "OR('LabOrgMSP.peer')"

      AnchorPeers:
        - Host: peer0.laborg.cold.coc.com
          Port: 8051

  # CourtOrg defines the court/external validator organization
  - &CourtOrg
      Name: CourtOrg
      ID: CourtOrgMSP
      MSPDir: /home/user/FYPBcoc/cold-blockchain/crypto-config/peerOrganizations/courtorg.cold.coc.com/msp

      Policies:
        Readers:
          Type: Signature
          Rule: "OR('CourtOrgMSP.admin', 'CourtOrgMSP.peer', 'CourtOrgMSP.client')"
        Writers:
          Type: Signature
          Rule: "OR('CourtOrgMSP.admin', 'CourtOrgMSP.peer', 'CourtOrgMSP.client')"
        Admins:
          Type: Signature
          Rule: "OR('CourtOrgMSP.admin')"
        Endorsement:
          Type: Signature
          Rule: "OR('CourtOrgMSP.peer')"

      AnchorPeers:
        - Host: peer0.courtorg.cold.coc.com
          Port: 9051

################################################################################
#
#   CAPABILITIES
#
#   This section defines the capabilities of fabric network. This is a new
#   concept as of v1.1.0 and should not be utilized in mixed networks with
#   v1.0.x peers and orderers. Capabilities define features which must be
#   present in a fabric binary for that binary to safely participate in the
#   fabric network. For instance, if a new MSP type is added, newer binaries
#   might recognize and validate the signatures from this type, while older
#   binaries without this support would be unable to validate those
#   transactions. This could lead to different versions of the fabric binaries
#   having different world states. Instead, defining a capability for a channel
#   informs those binaries without this capability that they must cease
#   processing transactions until they have been upgraded. For v1.0.x if any
#   capabilities are defined (including a map with all capabilities turned off)
#   then the v1.0.x peer will deliberately crash.
#
################################################################################

Capabilities:
  Channel: &ChannelCapabilities
    V2_5: true

  Orderer: &OrdererCapabilities
    V2_5: true

  Application: &ApplicationCapabilities
    V2_5: true

################################################################################
#
#   APPLICATION
#
#   This section defines the values to encode into a config transaction or
#   genesis block for application-related parameters.
#
################################################################################

Application: &ApplicationDefaults
  ACLs: &ACLsDefault
    # ACL policy for invoking chaincodes on peer
    _lifecycle/CheckCommitReadiness: /Channel/Application/Writers

    # ACL policy for querying chaincodes
    _lifecycle/CommitChaincodeDefinition: /Channel/Application/Writers

    # ACL policy for installing chaincode
    _lifecycle/QueryChaincodeDefinition: /Channel/Application/Writers
    _lifecycle/QueryChaincodeDefinitions: /Channel/Application/Writers

    # ACL policy for chaincode to chaincode invocation
    lscc/ChaincodeExists: /Channel/Application/Readers
    lscc/GetDeploymentSpec: /Channel/Application/Readers
    lscc/GetChaincodeData: /Channel/Application/Readers
    lscc/GetInstantiatedChaincodes: /Channel/Application/Readers

    # ACL policy for queries
    qscc/GetChainInfo: /Channel/Application/Readers
    qscc/GetBlockByNumber: /Channel/Application/Readers
    qscc/GetBlockByHash: /Channel/Application/Readers
    qscc/GetTransactionByID: /Channel/Application/Readers
    qscc/GetBlockByTxID: /Channel/Application/Readers

    # ACL policy for configuration
    cscc/GetConfigBlock: /Channel/Application/Readers
    cscc/GetChannelConfig: /Channel/Application/Readers

    # ACL policy for peer
    peer/Propose: /Channel/Application/Writers
    peer/ChaincodeToChaincode: /Channel/Application/Writers

    # ACL policy for events
    event/Block: /Channel/Application/Readers
    event/FilteredBlock: /Channel/Application/Readers

  Organizations:

  Policies: &ApplicationDefaultPolicies
    LifecycleEndorsement:
      Type: ImplicitMeta
      Rule: "MAJORITY Endorsement"
    Endorsement:
      Type: ImplicitMeta
      Rule: "MAJORITY Endorsement"
    Readers:
      Type: ImplicitMeta
      Rule: "ANY Readers"
    Writers:
      Type: ImplicitMeta
      Rule: "ANY Writers"
    Admins:
      Type: ImplicitMeta
      Rule: "MAJORITY Admins"

  Capabilities:
    <<: *ApplicationCapabilities

################################################################################
#
#   ORDERER
#
#   This section defines the values to encode into a config transaction or
#   genesis block for orderer related parameters.
#
################################################################################

Orderer: &OrdererDefaults
  OrdererType: etcdraft

  # Addresses of orderer nodes
  Addresses:
    - orderer.cold.coc.com:7150

  # Batch Timeout: The amount of time to wait before creating a batch
  BatchTimeout: 2s

  # Batch Size: Controls the number of messages batched into a block
  BatchSize:
    MaxMessageCount: 10
    AbsoluteMaxBytes: 99 MB
    PreferredMaxBytes: 512 KB

  # Raft Configuration
  EtcdRaft:
    Consenters:
      - Host: orderer.cold.coc.com
        Port: 7150
        ClientTLSCert: /home/user/FYPBcoc/cold-blockchain/crypto-config/ordererOrganizations/ordererorg.cold.coc.com/orderers/orderer.cold.coc.com/tls/server.crt
        ServerTLSCert: /home/user/FYPBcoc/cold-blockchain/crypto-config/ordererOrganizations/ordererorg.cold.coc.com/orderers/orderer.cold.coc.com/tls/server.crt

    # Options to be specified for all the etcdraft nodes. The values here
    # are the defaults for all new channels and can be modified on a
    # per-channel basis via configuration updates.
    Options:
      TickInterval: 500ms
      ElectionTick: 10
      HeartbeatTick: 1
      MaxInflightBlocks: 5
      SnapshotIntervalSize: 16 MB

  # Organizations lists the orgs participating on the orderer side of the network
  Organizations:

  # Policies defines the set of policies at the orderer level
  Policies:
    Readers:
      Type: ImplicitMeta
      Rule: "ANY Readers"
    Writers:
      Type: ImplicitMeta
      Rule: "ANY Writers"
    Admins:
      Type: ImplicitMeta
      Rule: "MAJORITY Admins"
    BlockValidation:
      Type: ImplicitMeta
      Rule: "ANY Writers"

  Capabilities:
    <<: *OrdererCapabilities

################################################################################
#
#   CHANNEL
#
#   This section defines the values to encode into a config transaction or
#   genesis block for channel related parameters.
#
################################################################################

Channel: &ChannelDefaults
  Policies:
    Readers:
      Type: ImplicitMeta
      Rule: "ANY Readers"
    Writers:
      Type: ImplicitMeta
      Rule: "ANY Writers"
    Admins:
      Type: ImplicitMeta
      Rule: "MAJORITY Admins"

  Capabilities:
    <<: *ChannelCapabilities

################################################################################
#
#   PROFILES
#
#   Different configuration profiles may be encoded here to be specified as
#   parameters to the configtxgen tool. The profiles which specify consortiums
#   are to be used for generating the orderer genesis block. With the correct
#   consortium members defined in the orderer genesis block, channel creation
#   requests may be generated with only the org member names and a consortium
#   name.
#
################################################################################

Profiles:
  # ColdChainGenesis defines the genesis block for the cold-chain channel
  # Cold chain includes both LabOrg and CourtOrg for archival and validation
  ColdChainGenesis:
    <<: *ChannelDefaults
    Orderer:
      <<: *OrdererDefaults
      Organizations:
        - *OrdererOrg
      Capabilities: *OrdererCapabilities
    Application:
      <<: *ApplicationDefaults
      Organizations:
        - *LabOrg
        - *CourtOrg
      Capabilities: *ApplicationCapabilities
