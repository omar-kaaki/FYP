FYP Blockchain - System Requirements
=====================================

Last Updated: 2025-11-22
Branch: claude/clone-fyp-repo-01GcQmZnMbvkNkxehnggLCs3

╔════════════════════════════════════════════════════════════════╗
║              MASTER INSTALLATION AND TESTING SCRIPTS           ║
╚════════════════════════════════════════════════════════════════╝

QUICK START
===========

1. INSTALL ALL PREREQUISITES (One Command):
    ./install-prerequisites.sh

2. TEST EVERYTHING (One Command):
    ./test-all.sh --skip-crypto

See README_TESTING.md for complete guide.

AUTOMATED INSTALLATION
======================
Run this single command to install everything:
    ./install-prerequisites.sh

This installs:
- Docker & Docker Compose
- Go 1.25.4
- Node.js 20.x LTS (required for Evidence Upload Service)
- TypeScript & ts-node
- Nginx (HTTPS reverse proxy for IPFS)
- Hyperledger Fabric v2.5.14 binaries
- Fabric CA v1.5.15 binaries
- All Docker images (Fabric, CouchDB, IPFS Kubo, Nginx)
- All tools (jq, tree, curl, wget, git, openssl, etc.)

COMPREHENSIVE TESTING
=====================
Test both hot and cold blockchains:

    # Quick test (recommended first)
    ./test-all.sh --skip-crypto

    # Full test with crypto generation
    ./test-all.sh

This validates:
- All prerequisites and tools
- Hot blockchain (4 CAs, 2 orgs)
- Cold blockchain (6 CAs, 3 orgs)
- MSP structures and NodeOUs
- TLS configurations
- Domain names (*.hot.coc.com / *.cold.coc.com)


Or manually install using the sections below.

CORE VERSIONS
=============
Hyperledger Fabric:     2.5.14 (LTS)
Fabric CA:              1.5.15
Go:                     1.25.4
Node.js:                20.x LTS (required for Evidence Upload Service)
TypeScript:             5.3+
Nginx:                  1.25+ (required for IPFS reverse proxy)
Docker Engine:          24.0+ (25.x recommended)
Docker Compose:         2.20+
CouchDB:                3.3.x
IPFS (Kubo):            0.24.0 (required for evidence storage)
Python:                 3.11+

SYSTEM REQUIREMENTS
===================
OS:                     64-bit Linux (Kali Linux / Debian recommended)
RAM:                    4GB minimum (8GB+ recommended)
Disk Space:             20GB free minimum
Network:                Internet connection required
Permissions:            sudo/root access required

APT PACKAGES (Debian/Ubuntu/Kali)
==================================
git
curl
wget
tar
unzip
jq
openssl
build-essential
tree
htop
python3
python3-pip
docker.io
docker-compose
nginx

DOCKER IMAGES REQUIRED
======================
hyperledger/fabric-peer:2.5.14
hyperledger/fabric-orderer:2.5.14
hyperledger/fabric-ca:1.5.15
hyperledger/fabric-tools:2.5.14
couchdb:3.3
ipfs/kubo:v0.24.0
nginx:1.25-alpine

FABRIC BINARIES (installed in ./bin/)
======================================
peer
orderer
configtxgen
configtxlator
osnadmin
fabric-ca-server
fabric-ca-client

INSTALLATION COMMANDS (Manual)
===============================

1. Update System
   -------------
   sudo apt update && sudo apt upgrade -y

2. Install Core Tools
   ------------------
   sudo apt install -y git curl wget tar unzip jq openssl build-essential tree htop python3 python3-pip

3. Install Docker
   --------------
   sudo apt install -y docker.io docker-compose
   sudo systemctl start docker
   sudo systemctl enable docker
   sudo usermod -aG docker $USER
   # Log out and back in after this

4. Install Go 1.25.4
   -----------------
   cd ~
   wget https://go.dev/dl/go1.25.4.linux-amd64.tar.gz
   sudo rm -rf /usr/local/go
   sudo tar -C /usr/local -xzf go1.25.4.linux-amd64.tar.gz
   echo 'export PATH=$PATH:/usr/local/go/bin' >> ~/.bashrc
   echo 'export PATH=$PATH:$HOME/go/bin' >> ~/.bashrc
   # Open a NEW terminal for PATH to take effect (DO NOT use 'source ~/.bashrc')
   rm go1.25.4.linux-amd64.tar.gz

5. Install Node.js 20.x (Optional)
   --------------------------------
   curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.0/install.sh | bash
   # Open a NEW terminal, then run:
   nvm install 20
   nvm use 20
   nvm alias default 20

6. Install Fabric Binaries
   ------------------------
   cd ~/FYPBcoc
   curl -sSL https://raw.githubusercontent.com/hyperledger/fabric/main/scripts/install-fabric.sh | bash -s -- binary 2.5.14 1.5.15
   echo 'export PATH=$PATH:~/FYPBcoc/bin' >> ~/.bashrc
   # Open a NEW terminal for PATH to take effect (DO NOT use 'source ~/.bashrc')
   # Optional: sudo cp bin/* /usr/local/bin/

7. Pull Docker Images
   ------------------
   docker pull hyperledger/fabric-peer:2.5.14
   docker pull hyperledger/fabric-orderer:2.5.14
   docker pull hyperledger/fabric-ca:1.5.15
   docker pull hyperledger/fabric-tools:2.5.14
   docker pull couchdb:3.3
   docker pull ipfs/kubo:latest

VERIFICATION COMMANDS
=====================
docker --version
docker-compose --version
go version
node --version (if installed)
npm --version (if installed)
fabric-ca-client version
configtxgen --version
peer version
docker images | grep hyperledger

TESTING THE SETUP
=================

TEST SCRIPT FEATURES:
- Validates all required tools (Docker, Fabric binaries, jq, etc.)
- Checks configuration files existence and syntax
- Validates MSP directory structures (org-level and node-level)
- Verifies NodeOUs config.yaml files
- Tests TLS directory structures
- Validates docker-compose files
- Tests CA container health and API responsiveness
- Optionally runs crypto generation and validates output
- Tests configtx.yaml channel configuration profiles
- Validates channel artifacts scripts (generate & create)
- Checks for existing channel artifacts

# Test HOT BLOCKCHAIN (Active Investigation Chain)
cd ~/FYPBcoc/hot-blockchain

# Quick validation (no crypto generation) - RECOMMENDED FIRST
./scripts/test-ca-setup.sh --skip-crypto

# Full test (starts CAs and generates crypto material)
./scripts/test-ca-setup.sh

# Manual crypto generation (if CAs already running)
docker-compose -f docker-compose-ca.yaml up -d
sleep 15
./scripts/generate-crypto.sh

# Test COLD BLOCKCHAIN (Archival Chain)
cd ~/FYPBcoc/cold-blockchain

# Quick validation (no crypto generation) - RECOMMENDED FIRST
./scripts/test-ca-setup.sh --skip-crypto

# Full test (starts CAs and generates crypto material)
./scripts/test-ca-setup.sh

# Manual crypto generation (if CAs already running)
docker-compose -f docker-compose-ca.yaml up -d
sleep 15
./scripts/generate-crypto.sh

# Generate channel artifacts
./scripts/generate-channel-artifacts.sh

# Create and join channel (requires network running)
./scripts/create-channel.sh

WHAT THE TESTS VALIDATE:
========================
1. Tool availability: Docker, docker-compose, fabric-ca-client, configtxgen, peer, jq, tree
2. Configuration files: configtx.yaml, docker-compose-ca.yaml, CA configs
3. MSP structure: Org-level MSPs with admincerts/, cacerts/, tlscacerts/
4. Node MSPs: Local MSPs for orderers and peers with all required directories
5. NodeOUs: config.yaml files with proper OU definitions
6. TLS structure: TLS directories for all nodes
7. CA health: Container status and API responsiveness
8. Crypto generation: Complete certificate and key generation
9. Channel artifacts scripts: generate-channel-artifacts.sh, create-channel.sh
10. configtx.yaml validation: Genesis block and channel configuration profiles

PROJECT STRUCTURE
=================
FYPBcoc/
├── bin/                          # Fabric binaries
├── hot-blockchain/               # HOT CHAIN (Active Investigation)
│   ├── ca-config/               # CA server configurations
│   │   ├── ordererorg-ca/
│   │   ├── ordererorg-tlsca/
│   │   ├── laborg-ca/
│   │   └── laborg-tlsca/
│   ├── crypto-config/           # Generated crypto material (gitignored)
│   ├── channel-artifacts/       # Generated channel artifacts (gitignored)
│   ├── scripts/                 # Automation scripts
│   │   ├── generate-crypto.sh
│   │   ├── generate-channel-artifacts.sh
│   │   ├── create-channel.sh
│   │   ├── deploy-chaincode.sh
│   │   ├── start-network.sh     # NEW: Start hot blockchain network
│   │   ├── stop-network.sh      # NEW: Stop hot blockchain network
│   │   └── test-ca-setup.sh
│   ├── chaincode/               # Hot chain chaincode
│   ├── configtx.yaml            # Hot chain configuration
│   ├── docker-compose-ca.yaml   # Hot chain CAs
│   └── docker-compose-network.yaml  # NEW: Hot network (orderer, peer, CouchDB)
├── cold-blockchain/              # COLD CHAIN (Archival)
│   ├── ca-config/               # CA server configurations
│   │   ├── ordererorg-ca/
│   │   ├── ordererorg-tlsca/
│   │   ├── laborg-ca/
│   │   ├── laborg-tlsca/
│   │   ├── courtorg-ca/
│   │   └── courtorg-tlsca/
│   ├── crypto-config/           # Generated crypto material (gitignored)
│   ├── channel-artifacts/       # Generated channel artifacts (gitignored)
│   ├── scripts/                 # Automation scripts
│   │   ├── generate-crypto.sh
│   │   ├── generate-channel-artifacts.sh
│   │   ├── create-channel.sh
│   │   ├── deploy-chaincode.sh
│   │   ├── start-network.sh     # NEW: Start cold blockchain network
│   │   ├── stop-network.sh      # NEW: Stop cold blockchain network
│   │   └── test-ca-setup.sh
│   ├── chaincode/               # Cold chain chaincode
│   ├── configtx.yaml            # Cold chain configuration
│   ├── docker-compose-ca.yaml   # Cold chain CAs
│   └── docker-compose-network.yaml  # NEW: Cold network (orderer, 2 peers, 2 CouchDBs)
├── coc_chaincode/                # Chain of Custody Chaincode
│   ├── access/                  # Casbin RBAC configuration
│   │   ├── casbin_model.conf   # RBAC domain model
│   │   └── casbin_policy.csv   # Permission policies
│   ├── rbac/                    # Gateway and user role management
│   │   ├── gateway.go          # Identity validation
│   │   └── userroles.go        # On-chain user role mapping
│   ├── domain/                  # Business logic
│   │   ├── investigation.go    # Investigation CRUD
│   │   ├── evidence.go         # Evidence CRUD + chain of custody
│   │   └── guidmap.go          # GUID mapping (cold-chain)
│   ├── utils/                   # Helper utilities
│   │   └── json.go             # JSON marshaling
│   ├── main.go                  # Chaincode entry point
│   ├── go.mod                   # Go module definition
│   ├── build.sh                 # Build and package script
│   └── README.md                # Chaincode documentation
├── ipfs-storage/                 # NEW: IPFS Infrastructure
│   ├── evidence-upload-service/ # Evidence upload microservice
│   │   ├── src/                 # TypeScript source code
│   │   │   ├── index.ts         # Main REST API server
│   │   │   ├── config.ts        # Configuration
│   │   │   ├── utils/           # Hash & logger utilities
│   │   │   └── services/        # IPFS & Fabric services
│   │   ├── package.json         # Node.js dependencies
│   │   ├── tsconfig.json        # TypeScript configuration
│   │   ├── Dockerfile           # Container image
│   │   └── .env.example         # Environment template
│   ├── nginx/                   # Nginx reverse proxy
│   │   ├── nginx.conf           # Nginx configuration
│   │   └── generate-ssl.sh      # SSL certificate generator
│   ├── docker-compose-ipfs.yaml # IPFS infrastructure
│   ├── start-ipfs.sh            # Start IPFS services
│   └── stop-ipfs.sh             # Stop IPFS services
├── install-prerequisites.sh      # Automated installer
├── test-all.sh                  # Comprehensive test suite
├── requirements.md               # Detailed documentation (Sections 1-8)
├── requirements.txt              # THIS FILE
├── INTEGRATION_JUMPSERVER.md     # NEW: JumpServer integration guide
└── .gitignore                    # Git ignore rules

CERTIFICATE AUTHORITIES
========================

HOT CHAIN (4 CAs - Active Investigation):
  OrdererOrg Identity CA:  localhost:7054  (ca-admin:ca-adminpw)
  OrdererOrg TLS CA:       localhost:8054  (tls-ca-admin:tlscapw)
  LabOrg Identity CA:      localhost:7055  (ca-admin:ca-adminpw)
  LabOrg TLS CA:           localhost:8055  (tls-ca-admin:tlscapw)

COLD CHAIN (6 CAs - Archival):
  OrdererOrg Identity CA:  localhost:7154  (ca-admin:ca-adminpw)
  OrdererOrg TLS CA:       localhost:8154  (tls-ca-admin:tlscapw)
  LabOrg Identity CA:      localhost:7155  (ca-admin:ca-adminpw)
  LabOrg TLS CA:           localhost:8155  (tls-ca-admin:tlscapw)
  CourtOrg Identity CA:    localhost:7156  (ca-admin:ca-adminpw)
  CourtOrg TLS CA:         localhost:8156  (tls-ca-admin:tlscapw)

IDENTITIES
==========

HOT CHAIN (*.hot.coc.com):
  OrdererOrg:
    - orderer.hot.coc.com (orderer)
    - orderer-admin@ordererorg.hot.coc.com (admin)
  LabOrg:
    - peer0.laborg.hot.coc.com (peer)
    - lab-admin@laborg.hot.coc.com (admin)
    - lab-gw@laborg.hot.coc.com (gateway client)

COLD CHAIN (*.cold.coc.com):
  OrdererOrg:
    - orderer.cold.coc.com (orderer)
    - orderer-admin@ordererorg.cold.coc.com (admin)
  LabOrg:
    - peer0.laborg.cold.coc.com (peer)
    - lab-admin@laborg.cold.coc.com (admin)
    - lab-gw@laborg.cold.coc.com (gateway client)
  CourtOrg:
    - peer0.courtorg.cold.coc.com (peer)
    - court-admin@courtorg.cold.coc.com (admin)

NETWORK TOPOLOGY
================

HOT BLOCKCHAIN (Active Investigation):
  - 1 Orderer node (orderer.hot.coc.com:7050)
  - 1 Peer node (peer0.laborg.hot.coc.com:7051)
  - Organizations: OrdererOrg, LabOrg
  - Endorsement: OR('LabOrgMSP.peer')

COLD BLOCKCHAIN (Archival):
  - 1 Orderer node (orderer.cold.coc.com:7150)
  - 2 Peer nodes:
    * peer0.laborg.cold.coc.com:8051
    * peer0.courtorg.cold.coc.com:9051
  - Organizations: OrdererOrg, LabOrg, CourtOrg
  - Endorsement: AND('LabOrgMSP.peer', 'CourtOrgMSP.peer')

CHAINCODE DEPLOYMENT
=====================

CHAINCODE: coc_chaincode (Chain of Custody)
- Language: Go 1.21
- RBAC: Casbin with domain support (hot/cold)
- Gateway Identity: lab-gw@LabOrgMSP (JumpServer)

DEPLOYED AS:
- hot_chaincode on hot-chain
  * Endorsement policy: OR('LabOrgMSP.peer')
  * Installed on: peer0.laborg.hot.coc.com

- cold_chaincode on cold-chain
  * Endorsement policy: AND('LabOrgMSP.peer','CourtOrgMSP.peer')
  * Installed on: peer0.laborg.cold.coc.com, peer0.courtorg.cold.coc.com

ROLES:
- BlockchainInvestigator: Create/modify on hot, read-only on cold
- BlockchainAuditor: Read-only on both chains
- BlockchainCourt: Archive/reopen/GUID management on cold
- SystemAdmin: User role management

DATA MODELS:
- Investigation: ID, title, description, status, timestamps, channel
- Evidence: ID, investigation ID, hash, IPFS CID, metadata, chain of custody
- GUID Mapping: GUID ↔ evidence ID (cold-chain only for court anonymization)
- User Role: Principal ID, roles array, updated info

BUILD AND DEPLOY:
1. Build chaincode:
   cd coc_chaincode && ./build.sh

2. Deploy to hot-chain:
   cd hot-blockchain && ./scripts/deploy-chaincode.sh

3. Deploy to cold-chain:
   cd cold-blockchain && ./scripts/deploy-chaincode.sh

4. Set user roles (admin function):
   peer chaincode invoke -C hot-chain -n hot_chaincode \
     -c '{"function":"SetUserRoles","Args":["LabOrgMSP|lab-gw|user:investigator1","BlockchainInvestigator"]}'

ACCESS CONTROL FLOW:
1. JumpServer connects with lab-gw gateway identity
2. Transient map contains userId and role (not stored on ledger)
3. Chaincode validates gateway identity (MSP ID + CN)
4. Extracts user context from transient
5. Builds principal ID: LabOrgMSP|lab-gw|user:<userId>
6. Validates user has claimed role in on-chain mapping
7. Enforces Casbin policy (role, domain, object, action)
8. Executes business logic if permitted

TROUBLESHOOTING
===============
Issue: Docker permission denied
Fix:   sudo usermod -aG docker $USER
       # Then log out and back in, or run: newgrp docker

Issue: fabric-ca-client not found
Fix:   export PATH=$PATH:~/FYPBcoc/bin
       # Or: sudo cp ~/FYPBcoc/bin/* /usr/local/bin/

Issue: CA containers won't start
Fix:   docker-compose -f docker-compose-ca.yaml down
       docker-compose -f docker-compose-ca.yaml up -d
       docker-compose -f docker-compose-ca.yaml logs

Issue: go: command not found
Fix:   export PATH=$PATH:/usr/local/go/bin
       Or open a NEW terminal (recommended)

Issue: Network connection issues
Fix:   Check DNS: ping 8.8.8.8
       Check internet: ping github.com
       Configure proxy if needed

NETWORK DEPLOYMENT
==================

HOT BLOCKCHAIN NETWORK:
- Orderer:     orderer.hot.coc.com (port 7050)
- Peer:        peer0.laborg.hot.coc.com (port 7051)
- CouchDB:     couchdb.peer0.laborg.hot.coc.com (port 5984)
- Operations:  localhost:9443 (Prometheus metrics)
- Features:    mTLS enabled, Fabric Gateway enabled

COLD BLOCKCHAIN NETWORK:
- Orderer:         orderer.cold.coc.com (port 7150)
- Peer (LabOrg):   peer0.laborg.cold.coc.com (port 8051)
- Peer (CourtOrg): peer0.courtorg.cold.coc.com (port 9051)
- CouchDB (Lab):   couchdb.peer0.laborg.cold.coc.com (port 6984)
- CouchDB (Court): couchdb.peer0.courtorg.cold.coc.com (port 7984)
- Operations (Lab): localhost:9543
- Operations (Court): localhost:9643
- Features:    mTLS enabled, Dual-peer endorsement

DEPLOYMENT COMMANDS:
1. Start networks:
   cd hot-blockchain && ./scripts/start-network.sh
   cd cold-blockchain && ./scripts/start-network.sh

2. Stop networks:
   cd hot-blockchain && ./scripts/stop-network.sh
   cd cold-blockchain && ./scripts/stop-network.sh

3. Health checks:
   curl http://localhost:9443/healthz  # Hot peer
   curl http://localhost:9543/healthz  # Cold LabOrg peer
   curl http://localhost:9643/healthz  # Cold CourtOrg peer

IPFS INFRASTRUCTURE
===================

COMPONENTS:
- IPFS Node:           ipfs.coc (ports 4001, 5001, 8080)
- Nginx Proxy:         ipfs-proxy.coc (ports 5443 HTTPS, 8443)
- Upload Service:      evidence-upload.coc (port 3000)

IPFS COMMANDS:
1. Start IPFS infrastructure:
   cd ipfs-storage && ./start-ipfs.sh

2. Stop IPFS infrastructure:
   cd ipfs-storage && ./stop-ipfs.sh

3. Build evidence upload service:
   cd ipfs-storage/evidence-upload-service
   npm install
   npm run build

EVIDENCE UPLOAD API:
- Health:       GET  http://localhost:3000/health
- Upload:       POST http://localhost:3000/api/evidence/upload
- Get metadata: GET  http://localhost:3000/api/evidence/:id?chain=hot
- Get file:     GET  http://localhost:3000/api/evidence/:id/file?chain=hot

EXAMPLE UPLOAD:
curl -X POST http://localhost:3000/api/evidence/upload \
  -F 'file=@evidence.zip' \
  -F 'investigationId=inv-001' \
  -F 'description=Evidence file' \
  -F 'userId=user:investigator1' \
  -F 'userRole=BlockchainInvestigator' \
  -F 'chain=hot'

CLEANUP COMMANDS
================

# Stop HOT chain network
cd ~/FYPBcoc/hot-blockchain
./scripts/stop-network.sh  # Or: docker-compose -f docker-compose-network.yaml down

# Stop COLD chain network
cd ~/FYPBcoc/cold-blockchain
./scripts/stop-network.sh  # Or: docker-compose -f docker-compose-network.yaml down

# Stop IPFS infrastructure
cd ~/FYPBcoc/ipfs-storage
./stop-ipfs.sh  # Or: docker-compose -f docker-compose-ipfs.yaml down

# Stop CA containers
cd ~/FYPBcoc/hot-blockchain
docker-compose -f docker-compose-ca.yaml down
cd ~/FYPBcoc/cold-blockchain
docker-compose -f docker-compose-ca.yaml down

# Remove generated crypto material
cd ~/FYPBcoc
rm -rf hot-blockchain/crypto-config/*
rm -rf cold-blockchain/crypto-config/*
rm -rf .fabric-ca-client/

# Remove all Docker containers
docker stop $(docker ps -aq)
docker rm $(docker ps -aq)

# Remove Fabric images
docker rmi $(docker images 'hyperledger/*' -q)

SUPPORT & DOCUMENTATION
=======================
Project Repository:       https://github.com/rae81/FYPBcoc
Development Branch:       claude/clone-fyp-repo-01GcQmZnMbvkNkxehnggLCs3
Fabric Documentation:     https://hyperledger-fabric.readthedocs.io/en/release-2.5/
Fabric CA Docs:           https://hyperledger-fabric-ca.readthedocs.io/
IPFS Docs:                https://docs.ipfs.tech/

PROJECT DOCUMENTATION:
- requirements.md                 (Sections 1-8: Complete technical guide)
- requirements.txt                (THIS FILE: Quick reference)
- INTEGRATION_JUMPSERVER.md       (JumpServer integration guide)
- install-prerequisites.sh        (Automated installation)
- test-all.sh                     (Comprehensive testing)

NOTES
=====
- Project split into hot-blockchain/ and cold-blockchain/ directories
- Hot chain: Active investigation (*.hot.coc.com)
- Cold chain: Archival with court validation (*.cold.coc.com)
- IPFS integration: Evidence files stored on IPFS, metadata on blockchain
- Evidence Upload Service: TypeScript microservice for JumpServer integration
- All paths use absolute references: /home/user/FYPBcoc/
- Private keys and certificates are gitignored for security
- Only NodeOUs config.yaml templates are version controlled
- Open a NEW terminal after installation to update PATH (DO NOT use 'source ~/.bashrc')
- Log out/in required after adding user to docker group
- Complete test suite: ./test-all.sh (13 phases, 200+ tests)
- Automated installation: ./install-prerequisites.sh (installs everything)
- For production, pin all Docker images to specific versions
- Apply regular security updates to all system components
- Dynamic certificate generation using Fabric CA v1.5.15
- mTLS enabled on all Fabric components
- Nginx reverse proxy for IPFS API (HTTPS)
- Node.js 20.x LTS and TypeScript 5.3+ required for evidence upload service
- See INTEGRATION_JUMPSERVER.md for JumpServer integration details
